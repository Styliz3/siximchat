<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sixim AI - Professional Conversational Interface</title>
    <style>
        /* Theme Variables */
        :root {
            /* Default Dark Theme */
            --dark-bg: #0a0a0d;
            --darker-bg: #070709;
            --accent: #7f3ace;
            --accent-light: #9f5ce2;
            --text: #f0f0f0;
            --text-secondary: #c0c0c0;
            --border: #2a2a30;
            --panel: #121218;
            --gradient: linear-gradient(135deg, #9f5ce2, #7f3ace);
            --logo-shadow: 0 0 15px rgba(127, 58, 206, 0.5);
            --input-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            --chat-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            --button-radius: 8px;
            --panel-radius: 12px;
        }
        
        /* Ocean Theme */
        [data-theme="ocean"] {
            --dark-bg: #061621;
            --darker-bg: #050e16;
            --accent: #0e88cc;
            --accent-light: #25a1e6;
            --text: #e5f2fa;
            --text-secondary: #b8d4e8;
            --border: #1c3a52;
            --panel: #0a2436;
            --gradient: linear-gradient(135deg, #25a1e6, #0e88cc);
            --logo-shadow: 0 0 15px rgba(14, 136, 204, 0.5);
        }
        
        /* Retro 90s Theme */
        [data-theme="retro90s"] {
            --dark-bg: #001a33;
            --darker-bg: #000a19;
            --accent: #ff6b99;
            --accent-light: #ff8fb2;
            --text: #f0f8ff;
            --text-secondary: #80d4ff;
            --border: #0066cc;
            --panel: #002952;
            --gradient: linear-gradient(90deg, #ff6b99, #cc00ff);
            --logo-shadow: 0 0 20px rgba(204, 0, 255, 0.6);
            --button-radius: 0px;
            --panel-radius: 0px;
        }
        
        /* Forest Theme */
        [data-theme="forest"] {
            --dark-bg: #0a1f0c;
            --darker-bg: #071307;
            --accent: #2e9d3a;
            --accent-light: #4eba59;
            --text: #e9f5ea;
            --text-secondary: #b3deba;
            --border: #1f4d24;
            --panel: #0e2a11;
            --gradient: linear-gradient(135deg, #4eba59, #2e9d3a);
            --logo-shadow: 0 0 15px rgba(46, 157, 58, 0.5);
        }
        
        /* Midnight Theme */
        [data-theme="midnight"] {
            --dark-bg: #0c0921;
            --darker-bg: #060513;
            --accent: #6247aa;
            --accent-light: #7a5ec1;
            --text: #f0e9ff;
            --text-secondary: #c4b6e2;
            --border: #2a1f5a;
            --panel: #10092e;
            --gradient: linear-gradient(135deg, #7a5ec1, #6247aa);
            --logo-shadow: 0 0 15px rgba(98, 71, 170, 0.5);
        }
        
        /* High Contrast */
        [data-theme="high-contrast"] {
            --dark-bg: #000000;
            --darker-bg: #000000;
            --accent: #ff9500;
            --accent-light: #ffaa33;
            --text: #ffffff;
            --text-secondary: #dddddd;
            --border: #555555;
            --panel: #111111;
            --gradient: linear-gradient(135deg, #ffaa33, #ff9500);
            --logo-shadow: 0 0 15px rgba(255, 149, 0, 0.5);
        }
        
        /* Modern Sleek */
        [data-theme="modern"] {
            --dark-bg: #141414;
            --darker-bg: #0a0a0a;
            --accent: #3d9df2;
            --accent-light: #5fb0fa;
            --text: #ffffff;
            --text-secondary: #b0b0b0;
            --border: #333333;
            --panel: #1c1c1c;
            --gradient: linear-gradient(135deg, #5fb0fa, #3d9df2);
            --logo-shadow: 0 0 15px rgba(61, 157, 242, 0.5);
            --button-radius: 10px;
            --panel-radius: 16px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        body {
            background-color: var(--dark-bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        /* Enhanced Welcome Animation */
        .welcome-screen {
            position: fixed;
            display: flex;
            justify-content: center;
            align-items: center;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--dark-bg);
            z-index: 1000;
            transition: opacity 0.7s ease-in-out;
        }
        
        .welcome-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .logo-container {
            transform: translateY(0);
            transition: transform 1.2s cubic-bezier(0.22, 1, 0.36, 1);
            position: relative;
        }
        
        .welcome-screen.hidden .logo-container {
            transform: translateY(100vh);
        }
        
        /* Enhanced Logo */
        .logo {
            font-size: 5rem;
            font-weight: 800;
            letter-spacing: -0.05em;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: white;
            position: relative;
            display: inline-block;
            margin-bottom: 1rem;
            text-shadow: var(--logo-shadow);
            position: relative;
        }
        
        .logo::before {
            content: "SIXIM";
            position: absolute;
            left: 0;
            top: 0;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            filter: blur(10px);
            opacity: 0.7;
            z-index: -1;
        }
        
        .logo::after {
            content: "";
            position: absolute;
            left: 0;
            bottom: -5px;
            height: 3px;
            width: 100%;
            background: var(--gradient);
            border-radius: 3px;
            box-shadow: 0 0 10px var(--accent);
        }
        
        .tap-instruction {
            color: var(--text-secondary);
            margin-top: 20px;
            font-size: 1.1rem;
            opacity: 0.7;
            text-align: center;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 0.9; }
            100% { opacity: 0.5; }
        }
        
        /* Main App Styles */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            width: 100%;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid var(--border);
            transition: border-color 0.3s ease;
            position: sticky;
            top: 0;
            background-color: var(--dark-bg);
            z-index: 100;
            width: 100%;
        }
        
        .header-logo {
            font-size: 1.8rem;
            font-weight: 800;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            position: relative;
        }
        
        .header-logo::before {
            content: "SIXIM";
            position: absolute;
            left: 0;
            top: 0;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            filter: blur(5px);
            opacity: 0.7;
            z-index: -1;
        }
        
        .header-controls {
            display: flex;
            gap: 15px;
        }
        
        /* Tab System Styles - Removed */
        
        /* Model Selector */
        .model-selector {
            position: relative;
        }
        
        .model-select-btn {
            background-color: var(--panel);
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: var(--button-radius);
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }
        
        .model-select-btn:hover {
            border-color: var(--accent);
        }
        
        .model-select-btn svg {
            width: 16px;
            height: 16px;
        }
        
        .model-dropdown {
            position: absolute;
            top: calc(100% + 5px);
            right: 0;
            background-color: var(--panel);
            border: 1px solid var(--border);
            border-radius: var(--panel-radius);
            width: 320px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 100;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            display: none;
            padding: 10px;
        }
        
        .model-dropdown.active {
            display: block;
            animation: fadeIn 0.2s ease;
        }
        
        .model-category {
            margin-bottom: 15px;
        }
        
        .model-category h4 {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 8px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--border);
        }
        
        .model-item {
            padding: 10px;
            border-radius: var(--button-radius);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s;
            margin-bottom: 5px;
        }
        
        .model-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .model-item.active {
            background-color: rgba(127, 58, 206, 0.15);
        }
        
        .model-name {
            font-size: 0.9rem;
        }
        
        .model-badge {
            font-size: 0.7rem;
            background-color: var(--accent);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
        }
        
        /* Theme Selector */
        .theme-selector {
            position: relative;
        }
        
        .theme-select-btn {
            background-color: var(--panel);
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: var(--button-radius);
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }
        
        .theme-select-btn:hover {
            border-color: var(--accent);
        }
        
        .theme-select-btn svg {
            width: 16px;
            height: 16px;
        }
        
        .theme-dropdown {
            position: absolute;
            top: calc(100% + 5px);
            right: 0;
            background-color: var(--panel);
            border: 1px solid var(--border);
            border-radius: var(--panel-radius);
            width: 280px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 100;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            display: none;
            padding: 10px;
        }
        
        .theme-dropdown.active {
            display: block;
            animation: fadeIn 0.2s ease;
        }
        
        .theme-item {
            padding: 10px;
            border-radius: var(--button-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background-color 0.2s;
            margin-bottom: 5px;
        }
        
        .theme-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .theme-item.active {
            background-color: rgba(127, 58, 206, 0.15);
        }
        
        .theme-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        
        .settings-btn {
            background-color: var(--panel);
            color: var(--text);
            border: 1px solid var(--border);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .settings-btn:hover {
            border-color: var(--accent);
        }
        
        .settings-btn svg {
            width: 18px;
            height: 18px;
        }
        
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 24px;
            margin: 0 auto;
            width: 100%;
            max-width: 800px;
            padding: 20px 0 100px;
            height: calc(100vh - 200px);
            position: relative;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--accent) var(--panel);
        }
        
        .chat-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .chat-container::-webkit-scrollbar-track {
            background: var(--panel);
            border-radius: 10px;
        }
        
        .chat-container::-webkit-scrollbar-thumb {
            background-color: var(--accent);
            border-radius: 10px;
        }
        
        .chat-container::-webkit-scrollbar-thumb:hover {
            background-color: var(--accent-light);
        }
        
        .message {
            display: flex;
            flex-direction: column;
            margin-bottom: 24px;
            animation: fadeIn 0.3s ease;
            padding: 16px;
            border-radius: var(--panel-radius);
            transition: background-color 0.2s ease;
            background-color: var(--panel);
            box-shadow: var(--chat-shadow);
            width: 100%;
        }
        
        .message:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .message-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .message-content {
            margin-left: 54px;
            line-height: 1.6;
        }
        
        .message-content strong {
            color: var(--accent-light);
            font-weight: 700;
        }
        
        .token-speed {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-top: 10px;
            margin-left: 54px;
            display: flex;
            align-items: center;
        }
        
        .token-speed svg {
            width: 14px;
            height: 14px;
            margin-right: 5px;
        }
        
        .avatar {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            margin-right: 16px;
            background-color: var(--panel);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 0;
            transition: background-color 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .user-avatar {
            background: var(--gradient);
            color: white;
            font-weight: 600;
        }
        
        .code-block {
            background-color: var(--darker-bg);
            border: 1px solid var(--border);
            border-radius: var(--button-radius);
            margin: 15px 0 15px 54px;
            overflow: hidden;
            transition: border-color 0.2s ease;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            width: calc(100% - 54px);
            position: relative;
        }
        
        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background-color: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid var(--border);
        }
        
        .code-title {
            font-family: monospace;
            font-size: 0.9rem;
            color: var(--accent-light);
            font-weight: 600;
        }
        
        .copy-button {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--text-secondary);
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
        }
        
        .copy-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
            color: var(--text);
        }
        
        .code-content {
            padding: 15px;
            overflow-x: auto;
            font-family: monospace;
            line-height: 1.6;
            font-size: 0.95rem;
        }
        
        /* Syntax highlighting for code */
        .code-content .keyword { color: #ff79c6; }
        .code-content .string { color: #f1fa8c; }
        .code-content .comment { color: #6272a4; }
        .code-content .function { color: #50fa7b; }
        .code-content .number { color: #bd93f9; }
        .code-content .operator { color: #ff79c6; }
        .code-content .variable { color: #8be9fd; }
        
        /* Scroll to bottom button */
        .scroll-to-bottom {
            position: fixed;
            bottom: 100px;
            right: 20px;
            background-color: var(--accent);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: none;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            z-index: 50;
            transition: all 0.2s ease;
        }
        
        .scroll-to-bottom:hover {
            background-color: var(--accent-light);
            transform: translateY(-2px);
        }
        
        .scroll-to-bottom svg {
            width: 20px;
            height: 20px;
        }
        
        .input-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 40px);
            max-width: 800px;
            background-color: var(--dark-bg);
            padding: 10px 0;
            transition: all 0.3s ease;
            z-index: 50;
        }
        
        .input-container.initial {
            bottom: 50%;
            transform: translate(-50%, 50%);
        }
        
        .textarea-wrapper {
            position: relative;
            border-radius: var(--panel-radius);
            border: 1px solid var(--border);
            background-color: var(--panel);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            overflow: hidden;
            box-shadow: var(--input-shadow);
            min-height: 56px;
            display: flex;
            align-items: center;
        }
        
        #userInput {
            flex: 1;
            border: none;
            outline: none;
            background: transparent;
            color: var(--text);
            padding: 16px;
            font-size: 16px;
            resize: none;
            line-height: 1.5;
            min-height: 56px;
            max-height: 200px;
        }
        
        .send-button {
            position: relative;
            right: 12px;
            background-color: transparent;
            color: var(--accent);
            border: none;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s, color 0.2s;
        }
        
        .send-button svg {
            width: 20px;
            height: 20px;
        }
        
        .send-button:hover {
            color: var(--accent-light);
        }
        
        .stop-button {
            position: absolute;
            right: 12px;
            background: #ff5252;
            color: white;
            border: none;
            border-radius: var(--button-radius);
            width: 32px;
            height: 32px;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .stop-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .new-chat-btn {
            background-color: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border);
            margin-right: 12px;
            padding: 6px 12px;
            font-size: 0.9rem;
            border-radius: var(--button-radius);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .new-chat-btn:hover {
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--text);
            border-color: var(--accent);
        }
        
        .suggestions-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
            padding: 0 5px;
            transition: opacity 0.3s ease;
        }
        
        .suggestions-container.hidden {
            display: none;
        }
        
        .suggestion-chip {
            background-color: var(--panel);
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 8px 15px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        
        .suggestion-chip:hover {
            background-color: var(--accent);
            color: white;
            border-color: var(--accent);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Improved Scrollbar for all elements */
        * {
            scrollbar-width: thin;
            scrollbar-color: var(--accent) var(--panel);
        }
        
        *::-webkit-scrollbar {
            width: 8px;
        }
        
        *::-webkit-scrollbar-track {
            background: var(--panel);
            border-radius: 10px;
        }
        
        *::-webkit-scrollbar-thumb {
            background-color: var(--accent);
            border-radius: 10px;
        }
        
        *::-webkit-scrollbar-thumb:hover {
            background-color: var(--accent-light);
        }
        
        .settings-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 500px;
            background-color: var(--panel);
            border: 1px solid var(--border);
            border-radius: var(--panel-radius);
            z-index: 200;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.3);
            display: none;
        }
        
        .settings-panel.active {
            display: block;
        }
        
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
        }
        
        .settings-header h3 {
            margin: 0;
            font-size: 1.2rem;
        }
        
        .close-settings {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            line-height: 1;
        }
        
        .settings-content {
            padding: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .settings-group {
            margin-bottom: 25px;
        }
        
        .settings-group h4 {
            margin-bottom: 15px;
            color: var(--accent-light);
            font-size: 1.1rem;
        }
        
        .settings-field {
            margin-bottom: 15px;
        }
        
        .settings-field label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .settings-field input {
            width: 100%;
            padding: 10px;
            background-color: var(--darker-bg);
            border: 1px solid var(--border);
            border-radius: var(--button-radius);
            color: var(--text);
            font-size: 0.9rem;
        }
        
        .groq-api-guide {
            background-color: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: var(--button-radius);
            margin-bottom: 20px;
            font-size: 0.9rem;
        }
        
        .groq-api-guide h5 {
            margin-top: 0;
            margin-bottom: 10px;
            color: var(--accent-light);
        }
        
        .groq-api-guide ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .groq-api-guide li {
            margin-bottom: 5px;
        }
        
        .groq-api-guide a {
            color: var(--accent-light);
            text-decoration: none;
        }
        
        .groq-api-guide a:hover {
            text-decoration: underline;
        }
        
        .save-api-key {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: var(--button-radius);
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s ease;
        }
        
        .save-api-key:hover {
            background-color: var(--accent-light);
        }
        
        .privacy-notice {
            background-color: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: var(--button-radius);
            font-size: 0.85rem;
            line-height: 1.5;
        }
        
        .welcome-message {
            font-size: 1.5rem;
            line-height: 1.5;
            margin-bottom: 20px;
            padding: 20px;
            background-color: var(--panel);
            border-radius: var(--panel-radius);
            box-shadow: var(--chat-shadow);
            color: var(--text);
        }
        
        .code-content {
            padding: 15px;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            line-height: 1.5;
            font-size: 0.9rem;
            white-space: pre;
            tab-size: 4;
        }
    </style>
</head>
<body data-theme="dark">
    <!-- Welcome Animation Screen -->
    <div class="welcome-screen">
        <div class="logo-container">
            <div class="logo">SIXIM</div>
            <div class="tap-instruction">Tap anywhere to chat</div>
        </div>
    </div>

    <!-- Main App -->
    <div class="container">
        <header>
            <div class="header-logo">SIXIM</div>
            <div class="header-controls">
                <div class="model-selector">
                    <button class="model-select-btn" id="modelSelectBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M21.17 8h-8.34c-.93 0-1.31-1.24-.55-1.84l4.17-3.33c.63-.5 1.54-.5 2.17 0l4.17 3.33c.76.6.38 1.84-.55 1.84z"/>
                            <path d="M21.17 16h-8.34c-.93 0-1.31 1.24-.55 1.84l4.17 3.33c.63.5 1.54.5 2.17 0l4.17-3.33c.76-.6.38-1.84-.55 1.84z"/>
                            <path d="M8 17l-6-6 6-6"/>
                        </svg>
                        <span id="currentModel">llama3-70b-8192</span>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                    <div class="model-dropdown" id="modelDropdown">
                        <div class="model-category">
                            <h4>Llama Models</h4>
                            <div class="model-item" data-model="llama3-8b-8192">
                                <span class="model-name">llama3-8b-8192</span>
                                <span class="model-badge">Fast</span>
                            </div>
                            <div class="model-item active" data-model="llama3-70b-8192">
                                <span class="model-name">llama3-70b-8192</span>
                                <span class="model-badge">Powerful</span>
                            </div>
                            <div class="model-item" data-model="llama-3.1-8b-instant">
                                <span class="model-name">llama-3.1-8b-instant</span>
                                <span class="model-badge">Instant</span>
                            </div>
                            <div class="model-item" data-model="llama-3.3-70b-versatile">
                                <span class="model-name">llama-3.3-70b-versatile</span>
                                <span class="model-badge">Versatile</span>
                            </div>
                        </div>
                        <div class="model-category">
                            <h4>Other Models</h4>
                            <div class="model-item" data-model="gemma2-9b-it">
                                <span class="model-name">gemma2-9b-it</span>
                                <span class="model-badge">Google</span>
                            </div>
                            <div class="model-item" data-model="qwen-2.5-coder-32b">
                                <span class="model-name">qwen-2.5-coder-32b</span>
                                <span class="model-badge">Coding</span>
                            </div>
                            <div class="model-item" data-model="mistral-saba-24b">
                                <span class="model-name">mistral-saba-24b</span>
                                <span class="model-badge">General</span>
                            </div>
                        </div>
                        <div class="model-category">
                            <h4>DeepSeek Models</h4>
                            <div class="model-item" data-model="deepseek-r1-distill-llama-70b">
                                <span class="model-name">deepseek-r1-distill-llama-70b</span>
                                <span class="model-badge">Advanced</span>
                            </div>
                            <div class="model-item" data-model="deepseek-r1-distill-qwen-32b">
                                <span class="model-name">deepseek-r1-distill-qwen-32b</span>
                                <span class="model-badge">Efficient</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="theme-selector">
                    <button class="theme-select-btn" id="themeSelectBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="5"></circle>
                            <path d="M12 1v2M12 21v2M4.2 4.2L5.6 5.6M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4"></path>
                        </svg>
                        <span id="currentTheme">Dark</span>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                    <div class="theme-dropdown" id="themeDropdown">
                        <div class="theme-item active" data-theme="dark">
                            <div class="theme-color" style="background: linear-gradient(135deg, #9f5ce2, #7f3ace);"></div>
                            <span>Dark</span>
                        </div>
                        <div class="theme-item" data-theme="ocean">
                            <div class="theme-color" style="background: linear-gradient(135deg, #25a1e6, #0e88cc);"></div>
                            <span>Ocean</span>
                        </div>
                        <div class="theme-item" data-theme="retro90s">
                            <div class="theme-color" style="background: linear-gradient(90deg, #ff6b99, #cc00ff);"></div>
                            <span>Retro 90s</span>
                        </div>
                        <div class="theme-item" data-theme="forest">
                            <div class="theme-color" style="background: linear-gradient(135deg, #4eba59, #2e9d3a);"></div>
                            <span>Forest</span>
                        </div>
                        <div class="theme-item" data-theme="midnight">
                            <div class="theme-color" style="background: linear-gradient(135deg, #7a5ec1, #6247aa);"></div>
                            <span>Midnight</span>
                        </div>
                        <div class="theme-item" data-theme="high-contrast">
                            <div class="theme-color" style="background: linear-gradient(135deg, #ffaa33, #ff9500);"></div>
                            <span>High Contrast</span>
                        </div>
                        <div class="theme-item" data-theme="modern">
                            <div class="theme-color" style="background: linear-gradient(135deg, #5fb0fa, #3d9df2);"></div>
                            <span>Modern</span>
                        </div>
                    </div>
                </div>
                
                <button class="settings-btn" id="settingsBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                </button>
            </div>
        </header>
        
        <div class="chat-container" id="chatContainer">
            <div class="welcome-message" id="welcomeMessage">
                Welcome to Sixim. Tell it what is your task, code, project. It will help always with solution.
            </div>
        </div>
        
        <div class="input-container initial" id="inputContainer">
            <div class="textarea-wrapper">
                <textarea id="userInput" placeholder="Message Sixim..." rows="1"></textarea>
                <button class="new-chat-btn" id="newChatBtn">New Chat</button>
                <button class="send-button" id="sendMessage">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M22 2L11 13M22 2L15 22l-4-9-9-4 20-7z"></path>
                    </svg>
                </button>
                <button class="stop-button" id="stopGeneration">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="6" y="6" width="12" height="12" rx="2" ry="2"></rect>
                    </svg>
                </button>
            </div>
            
            <div class="suggestions-container" id="suggestionContainer">
                <div class="suggestion-chip">Write Python code for a calculator</div>
                <div class="suggestion-chip">Explain quantum computing</div>
                <div class="suggestion-chip">Summarize the history of AI</div>
                <div class="suggestion-chip">Generate a to-do list template</div>
            </div>
        </div>
        
        <!-- Add Settings Panel -->
        <div class="settings-panel" id="settingsPanel">
            <div class="settings-header">
                <h3>Settings</h3>
                <button class="close-settings" id="closeSettings">×</button>
            </div>
            <div class="settings-content">
                <div class="settings-group">
                    <h4>API Settings</h4>
                    <div class="groq-api-guide">
                        <h5>How to Get Groq API Key:</h5>
                        <ol>
                            <li>Visit <a href="https://console.groq.com/signup" target="_blank">Groq Console</a> and create an account</li>
                            <li>After signing in, go to API Keys in your dashboard</li>
                            <li>Click "Create API Key" and give it a name</li>
                            <li>Copy your API key and paste it below</li>
                            <li>Click "Save API Key" to store it in your browser</li>
                        </ol>
                        <p>Your API key is stored locally and never sent to our servers.</p>
                    </div>
                    <div class="settings-field">
                        <label for="apiKey">Groq API Key</label>
                        <input type="password" id="apiKey" placeholder="Enter your Groq API key">
                    </div>
                    <button class="save-api-key" id="saveApiKey">Save API Key</button>
                </div>
                <div class="settings-group">
                    <h4>About</h4>
                    <p>Sixim AI Chat v1.0</p>
                    <p>A professional conversational interface.</p>
                    <div class="privacy-notice" style="margin-top: 20px;">
                        We don't save any of your data. All conversations and settings are stored locally in your browser. When you leave this site, all data is deleted.
                    </div>
                </div>
            </div>
        </div>

        <!-- Scroll to bottom button -->
        <div class="scroll-to-bottom" id="scrollToBottomBtn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                // Element references
                const welcomeScreen = document.querySelector('.welcome-screen');
                const inputContainer = document.getElementById('inputContainer');
                const userInput = document.getElementById('userInput');
                const sendButton = document.getElementById('sendMessage');
                const stopButton = document.getElementById('stopGeneration');
                const chatContainer = document.getElementById('chatContainer');
                const welcomeMessage = document.getElementById('welcomeMessage');
                const themeSelectBtn = document.getElementById('themeSelectBtn');
                const modelSelectBtn = document.getElementById('modelSelectBtn');
                const themeDropdown = document.getElementById('themeDropdown');
                const modelDropdown = document.getElementById('modelDropdown');
                const themeItems = document.querySelectorAll('.theme-item');
                const modelItems = document.querySelectorAll('.model-item');
                const currentThemeSpan = document.getElementById('currentTheme');
                const currentModelSpan = document.getElementById('currentModel');
                const settingsBtn = document.getElementById('settingsBtn');
                const settingsPanel = document.getElementById('settingsPanel');
                const closeSettings = document.getElementById('closeSettings');
                const saveApiKey = document.getElementById('saveApiKey');
                const apiKeyInput = document.getElementById('apiKey');
                const suggestionChips = document.querySelectorAll('.suggestion-chip');
                const newChatBtn = document.getElementById('newChatBtn');
                const scrollToBottomBtn = document.getElementById('scrollToBottomBtn');
                
                // Helper function for capitalization
                function capitalizeFirstLetter(string) {
                    return string.charAt(0).toUpperCase() + string.slice(1);
                }
                
                // State variables
                let currentModel = localStorage.getItem('sixim-model') || 'llama3-70b-8192';
                let currentTheme = localStorage.getItem('sixim-theme') || 'dark';
                let isGenerating = false;
                let conversationHistory = [];
                let isUserScrolling = false;
                let lastScrollTop = 0;
                let chatHistories = {}; // Store multiple chat histories
                let currentChatId = generateChatId(); // Current active chat ID
                
                function generateChatId() {
                    return 'chat_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                }
                
                // Initialize theme and model
                document.body.setAttribute('data-theme', currentTheme);
                currentThemeSpan.textContent = capitalizeFirstLetter(currentTheme);
                currentModelSpan.textContent = currentModel;
                
                // Update active theme and model in dropdowns
                themeItems.forEach(item => {
                    if (item.dataset.theme === currentTheme) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });
                
                modelItems.forEach(item => {
                    if (item.dataset.model === currentModel) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });
                
                // Welcome animation
                document.addEventListener('click', () => {
                    welcomeScreen.classList.add('hidden');
                    setTimeout(() => {
                        welcomeScreen.style.display = 'none';
                        
                        // Focus input after welcome screen disappears
                        setTimeout(() => {
                            inputContainer.classList.remove('initial');
                            userInput.focus();
                        }, 300);
                    }, 700);
                }, { once: true });
                
                // Adjust textarea height
                userInput.addEventListener('input', () => {
                    userInput.style.height = 'auto';
                    userInput.style.height = (userInput.scrollHeight) + 'px';
                });
                
                // Model dropdown toggle
                modelSelectBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    modelDropdown.classList.toggle('active');
                    themeDropdown.classList.remove('active');
                });
                
                // Theme dropdown toggle
                themeSelectBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    themeDropdown.classList.toggle('active');
                    modelDropdown.classList.remove('active');
                });
                
                // Close dropdowns when clicking elsewhere
                document.addEventListener('click', () => {
                    modelDropdown.classList.remove('active');
                    themeDropdown.classList.remove('active');
                });
                
                // Model selection
                modelItems.forEach(model => {
                    model.addEventListener('click', () => {
                        const selectedModel = model.dataset.model;
                        currentModel = selectedModel;
                        localStorage.setItem('sixim-model', selectedModel);
                        currentModelSpan.textContent = selectedModel;
                        
                        modelItems.forEach(item => {
                            if (item.dataset.model === selectedModel) {
                                item.classList.add('active');
                            } else {
                                item.classList.remove('active');
                            }
                        });
                        
                        modelDropdown.classList.remove('active');
                    });
                });
                
                // Theme selection
                themeItems.forEach(theme => {
                    theme.addEventListener('click', () => {
                        const selectedTheme = theme.dataset.theme;
                        currentTheme = selectedTheme;
                        localStorage.setItem('sixim-theme', selectedTheme);
                        document.body.setAttribute('data-theme', selectedTheme);
                        currentThemeSpan.textContent = capitalizeFirstLetter(selectedTheme);
                        
                        themeItems.forEach(item => {
                            if (item.dataset.theme === selectedTheme) {
                                item.classList.add('active');
                            } else {
                                item.classList.remove('active');
                            }
                        });
                        
                        themeDropdown.classList.remove('active');
                    });
                });
                
                // Settings panel toggle
                settingsBtn.addEventListener('click', () => {
                    settingsPanel.classList.add('active');
                    if (localStorage.getItem('groq-api-key')) {
                        apiKeyInput.value = "••••••••••••••••••••••••";
                    }
                });
                
                closeSettings.addEventListener('click', () => {
                    settingsPanel.classList.remove('active');
                });
                
                // Save API key
                saveApiKey.addEventListener('click', () => {
                    const apiKey = apiKeyInput.value.trim();
                    if (apiKey && apiKey !== "••••••••••••••••••••••••") {
                        localStorage.setItem('groq-api-key', apiKey);
                        alert('API key saved successfully!');
                    } else if (apiKey === "") {
                        localStorage.removeItem('groq-api-key');
                        alert('API key removed!');
                    }
                });
                
                // Send message
                function sendMessage() {
                    const message = userInput.value.trim();
                    if (message === '' || isGenerating) return;
                    
                    // Clear input
                    userInput.value = '';
                    userInput.style.height = 'auto';
                    
                    // Add user message to chat
                    addMessageToChat('user', message);
                    
                    // Add to history
                    conversationHistory.push({
                        role: "user",
                        content: message
                    });
                    
                    // Simulate AI response
                    generateResponse(message);
                    
                    // Remove welcome message if present
                    if (welcomeMessage) {
                        welcomeMessage.style.display = 'none';
                    }
                    
                    // Remove initial class from input container
                    inputContainer.classList.remove('initial');
                    
                    // Hide suggestions after first message
                    document.getElementById('suggestionContainer').classList.add('hidden');
                }
                
                // Send message on button click
                sendButton.addEventListener('click', sendMessage);
                
                // Send message on Enter (but allow shift+enter for new lines)
                userInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });
                
                // Stop generation
                stopButton.addEventListener('click', () => {
                    if (isGenerating) {
                        isGenerating = false;
                        stopButton.style.display = 'none';
                        
                        // Add a note that generation was stopped
                        const lastMessage = document.querySelector('.message:last-child .message-content');
                        if (lastMessage) {
                            lastMessage.innerHTML += '<p><em>[Generation stopped by user]</em></p>';
                        }
                    }
                });
                
                // New chat
                newChatBtn.addEventListener('click', () => {
                    // Clear chat
                    chatContainer.innerHTML = `
                        <div class="welcome-message" id="welcomeMessage">
                            Welcome to Sixim. Tell it what is your task, code, project. It will help always with solution.
                        </div>
                    `;
                    
                    // Save current conversation history before clearing
                    if (conversationHistory.length > 0) {
                        chatHistories[currentChatId] = [...conversationHistory];
                    }
                    
                    // Create new chat ID and reset conversation history
                    currentChatId = generateChatId();
                    conversationHistory = [];
                    
                    // Focus input
                    userInput.focus();
                });
                
                // Add message to chat
                function addMessageToChat(sender, content) {
                    const messageEl = document.createElement('div');
                    messageEl.className = 'message';
                    
                    let avatar;
                    let nameDisplay;
                    
                    if (sender === 'user') {
                        avatar = `<div class="avatar user-avatar">U</div>`;
                        nameDisplay = 'You';
                    } else {
                        avatar = `
                            <div class="avatar">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <path d="M12 16v-4M12 8h.01"></path>
                                </svg>
                            </div>
                        `;
                        nameDisplay = 'Sixim';
                    }
                    
                    messageEl.innerHTML = `
                        <div class="message-header">
                            ${avatar}
                            <strong>${nameDisplay}</strong>
                        </div>
                        <div class="message-content">${sender === 'user' ? escapeHtml(content) : formatContent(content)}</div>
                    `;
                    
                    if (sender === 'ai') {
                        messageEl.innerHTML += `
                            <div class="token-speed">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
                                </svg>
                                ~15 tokens/s
                            </div>
                        `;
                    }
                    
                    chatContainer.appendChild(messageEl);
                    scrollToBottom();
                    
                    // Remove welcome message if this is the first user message
                    if (sender === 'user' && chatContainer.querySelector('#welcomeMessage')) {
                        const welcomeMsg = chatContainer.querySelector('#welcomeMessage');
                        if (welcomeMsg) welcomeMsg.remove();
                    }
                }
                
                // Format content with Markdown-like enhancements and syntax highlighting
                function formatContent(content) {
                    // Bold text
                    content = content.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                    
                    // Code highlighting - check for code blocks first
                    const codeBlockRegex = /```(\w+)?\n([\s\S]*?)```/g;
                    const codeBlocks = [];
                    let match;
                    let lastIndex = 0;
                    
                    // Extract code blocks and replace with placeholders
                    while ((match = codeBlockRegex.exec(content)) !== null) {
                        const placeholder = `__CODE_BLOCK_${codeBlocks.length}__`;
                        const language = match[1] || 'text';
                        const code = match[2];
                        
                        codeBlocks.push({
                            language,
                            code
                        });
                        
                        const beforeMatch = content.substring(lastIndex, match.index);
                        content = content.substring(0, lastIndex) + beforeMatch + placeholder + 
                                  content.substring(match.index + match[0].length);
                        lastIndex = lastIndex + beforeMatch.length + placeholder.length;
                        codeBlockRegex.lastIndex = lastIndex;
                    }
                    
                    // Inline code
                    content = content.replace(/`([^`]+)`/g, '<code>$1</code>');
                    
                    // Replace newlines with <br> tags
                    content = content.replace(/\n/g, '<br>');
                    
                    // Reinsert code blocks
                    for (let i = 0; i < codeBlocks.length; i++) {
                        const codeBlock = codeBlocks[i];
                        const placeholder = `__CODE_BLOCK_${i}__`;
                        const highlightedCode = applySyntaxHighlighting(codeBlock.code, codeBlock.language);
                        
                        content = content.replace(placeholder, `
                            <div class="code-block">
                                <div class="code-header">
                                    <div class="code-title">${codeBlock.language}</div>
                                    <button class="copy-button">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                            <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"></path>
                                        </svg>
                                        Copy
                                    </button>
                                </div>
                                <pre class="code-content">${highlightedCode}</pre>
                            </div>
                        `);
                    }
                    
                    return content;
                }
                
                // Apply syntax highlighting to code
                function applySyntaxHighlighting(code, language) {
                    // Simple regex-based syntax highlighting
                    let highlightedCode = escapeHtml(code);
                    
                    // Different highlighting patterns based on language
                    if (language === 'javascript' || language === 'js') {
                        // Keywords
                        highlightedCode = highlightedCode.replace(/\b(const|let|var|function|return|if|else|for|while|switch|case|break|continue|new|this|class|import|export|from|try|catch|throw|async|await)\b/g, '<span class="keyword">$1</span>');
                        // Strings
                        highlightedCode = highlightedCode.replace(/(["'`])(.*?)\1/g, '<span class="string">$&</span>');
                        // Numbers
                        highlightedCode = highlightedCode.replace(/\b(\d+)\b/g, '<span class="number">$1</span>');
                        // Comments
                        highlightedCode = highlightedCode.replace(/(\/\/.*)/g, '<span class="comment">$1</span>');
                        // Functions
                        highlightedCode = highlightedCode.replace(/\b([a-zA-Z_$][a-zA-Z0-9_$]*)\s*\(/g, '<span class="function">$1</span>(');
                    } else if (language === 'python' || language === 'py') {
                        // Keywords
                        highlightedCode = highlightedCode.replace(/\b(def|class|import|from|as|if|elif|else|for|while|return|try|except|with|in|not|and|or|True|False|None)\b/g, '<span class="keyword">$1</span>');
                        // Strings
                        highlightedCode = highlightedCode.replace(/(["'`])(.*?)\1/g, '<span class="string">$&</span>');
                        // Numbers
                        highlightedCode = highlightedCode.replace(/\b(\d+)\b/g, '<span class="number">$1</span>');
                        // Comments
                        highlightedCode = highlightedCode.replace(/(#.*)/g, '<span class="comment">$1</span>');
                        // Functions
                        highlightedCode = highlightedCode.replace(/\b([a-zA-Z_][a-zA-Z0-9_]*)\s*\(/g, '<span class="function">$1</span>(');
                    } else if (language === 'html') {
                        // Tags
                        highlightedCode = highlightedCode.replace(/(&lt;\/?[a-zA-Z0-9]+)(\s|&gt;)/g, '<span class="keyword">$1</span>$2');
                        // Attributes
                        highlightedCode = highlightedCode.replace(/\s([a-zA-Z-]+)=["']/g, ' <span class="variable">$1</span>=');
                        // Values
                        highlightedCode = highlightedCode.replace(/(["'])(.*?)(\1)/g, '<span class="string">$1$2$3</span>');
                    } else if (language === 'css') {
                        // Selectors
                        highlightedCode = highlightedCode.replace(/([.#][a-zA-Z-_0-9]+)/g, '<span class="variable">$1</span>');
                        // Properties
                        highlightedCode = highlightedCode.replace(/\b([a-zA-Z-]+):/g, '<span class="keyword">$1</span>:');
                        // Values
                        highlightedCode = highlightedCode.replace(/:\s*([^;]+);/g, ': <span class="string">$1</span>;');
                    }
                    
                    return highlightedCode;
                }
                
                // Escape HTML to prevent XSS
                function escapeHtml(unsafe) {
                    return unsafe
                        .replace(/&/g, "&amp;")
                        .replace(/</g, "&lt;")
                        .replace(/>/g, "&gt;")
                        .replace(/"/g, "&quot;")
                        .replace(/'/g, "&#039;");
                }
                
                // AI response generation simulation
                async function generateResponse(prompt) {
                    // Add AI message to chat with initial empty content
                    addMessageToChat('ai', '');
                    
                    // Check if API key exists
                    const apiKey = localStorage.getItem('groq-api-key');
                    if (!apiKey) {
                        const lastMessageContent = document.querySelector('.message:last-child .message-content');
                        if (lastMessageContent) {
                            lastMessageContent.innerHTML = 'Please set your Groq API key in the settings panel to use real streaming.';
                            settingsPanel.classList.add('active');
                        }
                        return;
                    }
                    
                    // Specifically for code, we'll show a "Preparing code..." message
                    if (prompt.toLowerCase().includes('code') || prompt.toLowerCase().includes('script') || 
                        prompt.toLowerCase().includes('function') || prompt.toLowerCase().includes('program')) {
                        const lastMessageContent = document.querySelector('.message:last-child .message-content');
                        if (lastMessageContent) {
                            lastMessageContent.innerHTML = 'Preparing code...';
                        }
                    }
                    
                    // Show stop button during generation
                    isGenerating = true;
                    stopButton.style.display = 'flex';
                    
                    // Hide suggestions after first message
                    document.getElementById('suggestionContainer').classList.add('hidden');
                    
                    // Prepare the messages for the API
                    const messages = conversationHistory.map(msg => ({
                        role: msg.role,
                        content: msg.content
                    }));
                    
                    // Add the current prompt
                    messages.push({ role: "user", content: prompt });
                    
                    // Prepare the API request
                    const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: currentModel,
                            messages: messages,
                            temperature: 0.7,
                            max_tokens: 4000,
                            stream: true
                        })
                    });
                    
                    // Check if the response is OK
                    if (!response.ok) {
                        let errorText = '';
                        try {
                            const errorData = await response.json();
                            errorText = errorData.error.message || 'Error connecting to Groq API';
                        } catch (e) {
                            errorText = `Error: ${response.status} ${response.statusText}`;
                        }
                        
                        const lastMessageContent = document.querySelector('.message:last-child .message-content');
                        if (lastMessageContent) {
                            lastMessageContent.innerHTML = errorText;
                        }
                        return;
                    }
                    
                    // Process the streaming response
                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();
                    let fullContent = '';
                    let tokensPerSecond = 0;
                    let lastTokenCount = 0;
                    let startTime = Date.now();
                    let buffer = '';
                    
                    // Start a timer to update tokensPerSecond
                    const tokenSpeedInterval = setInterval(() => {
                        const elapsedTimeInSeconds = (Date.now() - startTime) / 1000;
                        if (elapsedTimeInSeconds > 0) {
                            tokensPerSecond = Math.round(fullContent.split(/\s+/).length / elapsedTimeInSeconds);
                            
                            // Update token speed display
                            const tokenSpeedElement = document.querySelector('.message:last-child .token-speed');
                            if (tokenSpeedElement) {
                                tokenSpeedElement.innerHTML = `
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
                                    </svg>
                                    ~${tokensPerSecond} tokens/s
                                `;
                            }
                        }
                    }, 1000);
                    
                    const processStream = async () => {
                        while (true) {
                            const { done, value } = await reader.read();
                            
                            if (done) {
                                clearInterval(tokenSpeedInterval);
                                break;
                            }
                            
                            // Decode the chunk and add to buffer
                            buffer += decoder.decode(value, { stream: true });
                            
                            // Process complete lines in the buffer
                            const lines = buffer.split('\n');
                            buffer = lines.pop() || ''; // Keep the last incomplete line in the buffer
                            
                            // Check if content contains a code block that hasn't been processed yet
                            const hasCodeBlock = fullContent.includes('```') && !fullContent.match(/```[\s\S]*?```/);
                            if (hasCodeBlock) {
                                const lastMessageContent = document.querySelector('.message:last-child .message-content');
                                if (lastMessageContent) {
                                    lastMessageContent.innerHTML = formatContent(fullContent) + '<div><em>Preparing code...</em></div>';
                                }
                            } else {
                                const lastMessageContent = document.querySelector('.message:last-child .message-content');
                                if (lastMessageContent) {
                                    lastMessageContent.innerHTML = formatContent(fullContent);
                                }
                            }
                            
                            for (const line of lines) {
                                if (line.startsWith('data: ')) {
                                    const data = line.slice(6); // Remove 'data: ' prefix
                                    
                                    if (data === '[DONE]') {
                                        isGenerating = false;
                                        break;
                                    }
                                    
                                    try {
                                        const json = JSON.parse(data);
                                        const content = json.choices[0]?.delta?.content || '';
                                        
                                        if (content) {
                                            fullContent += content;
                                            // Only update the formatted content if we don't have an incomplete code block
                                            if (!hasCodeBlock) {
                                                const lastMessageContent = document.querySelector('.message:last-child .message-content');
                                                if (lastMessageContent) {
                                                    lastMessageContent.innerHTML = formatContent(fullContent);
                                                }
                                            }
                                            scrollToBottom();
                                        }
                                    } catch (e) {
                                        console.error('Error parsing JSON:', e);
                                    }
                                }
                            }
                        }
                        
                        // Process any remaining data
                        if (buffer) {
                            if (buffer.startsWith('data: ') && buffer !== 'data: [DONE]') {
                                try {
                                    const json = JSON.parse(buffer.slice(6));
                                    const content = json.choices[0]?.delta?.content || '';
                                    
                                    if (content) {
                                        fullContent += content;
                                        const lastMessageContent = document.querySelector('.message:last-child .message-content');
                                        if (lastMessageContent) {
                                            lastMessageContent.innerHTML = formatContent(fullContent);
                                        }
                                    }
                                } catch (e) {
                                    console.error('Error parsing JSON:', e);
                                }
                            }
                        }
                        
                        clearInterval(tokenSpeedInterval);
                        isGenerating = false;
                        stopButton.style.display = 'none';
                        
                        // Add to conversation history
                        conversationHistory.push({
                            role: "assistant",
                            content: fullContent
                        });
                        
                        // Save current conversation in the chat histories
                        chatHistories[currentChatId] = [...conversationHistory];
                        
                        // Limit history to last 10 messages
                        if (conversationHistory.length > 10) {
                            conversationHistory = conversationHistory.slice(-10);
                        }
                        
                        // Activate copy buttons
                        activateCopyButtons();
                    };
                    
                    await processStream();
                };
                
                // Activate copy buttons
                function activateCopyButtons() {
                    const copyButtons = document.querySelectorAll('.copy-button');
                    copyButtons.forEach(button => {
                        button.addEventListener('click', function() {
                            const codeBlock = this.closest('.code-block');
                            const code = codeBlock.querySelector('.code-content').textContent;
                            
                            navigator.clipboard.writeText(code).then(() => {
                                const originalText = this.innerHTML;
                                this.innerHTML = `
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                        <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"></path>
                                    </svg>
                                    Copied!
                                `;
                                
                                setTimeout(() => {
                                    this.innerHTML = originalText;
                                }, 2000);
                            });
                        });
                    });
                }
                
                // Suggestion chips click handler
                suggestionChips.forEach(chip => {
                    chip.addEventListener('click', () => {
                        userInput.value = chip.textContent;
                        userInput.style.height = 'auto';
                        userInput.style.height = (userInput.scrollHeight) + 'px';
                        userInput.focus();
                    });
                });
                
                // Scroll to bottom of chat
                function scrollToBottom() {
                    if (!isUserScrolling) {
                        chatContainer.scrollTop = chatContainer.scrollHeight;
                    }
                }
                
                // Make sure to scroll to bottom when window resizes
                window.addEventListener('resize', scrollToBottom);
                
                // Scroll handling
                chatContainer.addEventListener('scroll', () => {
                    const scrollTop = chatContainer.scrollTop;
                    const scrollHeight = chatContainer.scrollHeight;
                    const clientHeight = chatContainer.clientHeight;
                    
                    // Detect if user is scrolling up
                    if (scrollTop < lastScrollTop) {
                        isUserScrolling = true;
                    }
                    
                    // Show scroll button when not at bottom
                    if (scrollHeight - scrollTop - clientHeight > 50) {
                        scrollToBottomBtn.style.display = 'flex';
                    } else {
                        scrollToBottomBtn.style.display = 'none';
                        isUserScrolling = false;
                    }
                    
                    lastScrollTop = scrollTop;
                });
                
                // Scroll to bottom button click
                scrollToBottomBtn.addEventListener('click', () => {
                    scrollToBottom();
                    isUserScrolling = false;
                });
            });
        </script>
    </body>
</html>